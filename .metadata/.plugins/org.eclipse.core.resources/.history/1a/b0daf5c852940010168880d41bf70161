package com.coupang.scrap.login;

import java.net.MalformedURLException;
import java.net.URL;
import java.util.Arrays;
import java.util.List;

import org.openqa.selenium.WebDriver;

import com.coupang.scrap.list.AllThatFactoryProductListPage;
import com.coupang.scrap.list.BonniepetProductListPage;
import com.coupang.scrap.list.EchobelleProductListPage;
import com.coupang.scrap.list.JapanFoodMallProductListPage;
import com.coupang.scrap.list.OwnerClanProductListPage;
import com.coupang.scrap.list.PettobProductListPage;
import com.coupang.scrap.list.ProFishingProductListPage;
import com.coupang.scrap.list.ProductListPage;
import com.coupang.scrap.list.ZentradeProductListPage;
import com.coupang.scrap.soldout.AllThatFactorySoldOutPage;
import com.coupang.scrap.soldout.BonniepetSoldOutPage;
import com.coupang.scrap.soldout.EchobelleSoldOutPage;
import com.coupang.scrap.soldout.HaeTradingSoldOutPage;
import com.coupang.scrap.soldout.JapanFoodMallSoldOutPage;
import com.coupang.scrap.soldout.OwnerClanSoldOutPage;
import com.coupang.scrap.soldout.PettobSoldOutPage;
import com.coupang.scrap.soldout.ProFishingSoldOutPage;
import com.coupang.scrap.soldout.SoldOutPage;
import com.coupang.scrap.soldout.ZentradeSoldOutPage;

public enum LoginSite {
	
    PETTOB("https://pettob.co.kr/shop/main/intro_member.php?returnUrl=%2Fshop%2Fmain%2Findex.php", 
    		PettobLoginPage.class,
    		PettobProductListPage.class, 
    		PettobSoldOutPage.class,
    		Arrays.asList("pettob")
    		),
	BONNIEPET("http://bonniepet.co.kr/member/login.php",
			BonniepetLoginPage.class,
			BonniepetProductListPage.class,
			BonniepetSoldOutPage.class,
			Arrays.asList("bonniepet") 
			),
	JAPANFOODMALL("https://www.japanfoodmall.com/member/login.php",
			JapanFoodMallLoginPage.class,
			JapanFoodMallProductListPage.class,
			JapanFoodMallSoldOutPage.class,
			Arrays.asList("japanfoodmall")
			),
	JANTRADE("https://www.zentrade.co.kr/shop/member/login.php",
			ZentradeLoginPage.class,
			ZentradeProductListPage.class,
			ZentradeSoldOutPage.class,
			Arrays.asList("zentrade")
			),
	OWNERCLAN("https://ownerclan.com/V2/member/loginform.php",
			OwnerClanLoginPage.class,
			OwnerClanProductListPage.class,
			OwnerClanSoldOutPage.class,
			Arrays.asList("ownerclan")
			),
	ALLTHATFACTORY("https://allthatfactory.co.kr/member/member.html?mode=login",
			AllThatFactoryLoginPage.class,
			AllThatFactoryProductListPage.class,
			AllThatFactorySoldOutPage.class,
			Arrays.asList("allthatfactory")
			),
	ECHOBELLE("https://echobelle.e3pl.kr/",
			EchobelleLoginPage.class,
			EchobelleProductListPage.class,
			EchobelleSoldOutPage.class,
			Arrays.asList("echobelle")
			),
	PROFISHING("https://pfb2b.co.kr/",
			ProFishingLoginPage.class,
			ProFishingProductListPage.class,
			ProFishingSoldOutPage.class,
			Arrays.asList("haetrading")
			
			)
	;
	
	//    DDAKPET("https://www.ddakpet.com/team3f/myshop/login?join=false", DdakpetLoginPage.class),
//    SUJINPET("https://www.sujinpet.co.kr/front/member/member_login.php", SujinpetLoginPage.class),
//    BONNIEPET("http://bonniepet.co.kr/member/login.php", BonniepetLoginPage.class),
//    PETTORY("https://pettory.com/member/login.html", PettoryLoginPage.class),
//    OFFRUN("https://offrun.kr/main/signIn", OffrunLoginPage.class), //첫번쨰 계정
//    JAPANFOODMALL("https://japanfoodmall.com/member/login.php", JpanFoodMallLoginPage.class),
//    ECHOBELLE("https://echobelle.e3pl.kr/", EchobelleLoginPage.class),
//    ALLTHATFACTORY("https://allthatfactory.co.kr/member/member.html?mode=login", AllThatFactoryLoginPage.class),
//    OWNERCLAN("https://ownerclan.com/V2/member/loginform.php", OwnerClanLoginPage.class); // 
    
	private final String loginUrl;
    private final Class<? extends LoginPage> pageClass;
    private final Class<? extends ProductListPage> productPageClass;
    private final Class<? extends SoldOutPage> soldOutPageClass;
    private final List<String> aliases;

    LoginSite(String loginUrl,
              Class<? extends LoginPage> pageClass,
              Class<? extends ProductListPage> productPageClass,
              Class<? extends SoldOutPage> soldOutPageClass,
              List<String> aliases) {
        this.loginUrl = loginUrl;
        this.pageClass = pageClass;
        this.productPageClass = productPageClass;
        this.soldOutPageClass = soldOutPageClass;
        this.aliases = aliases;
    }

	public boolean matches(String siteName) {
        if (siteName == null) return false;
        return aliases.stream().anyMatch(a -> a.equalsIgnoreCase(siteName));
    }

    public String getLoginUrl() { return loginUrl; }
    public Class<? extends LoginPage> getPageClass() { return pageClass; }
    public Class<? extends ProductListPage> getProductPageClass() { return productPageClass; }

    public static LoginSite fromDomain(String domain) {
        for (LoginSite site : values()) {
            try {
                String siteDomain = new URL(site.loginUrl).getHost();
                if (domain.equalsIgnoreCase(siteDomain)) {
                    return site;
                }
            } catch (MalformedURLException e) {
                e.printStackTrace();
            }
        }
        return null;
    }

    public ProductListPage createProductListPage(WebDriver driver, String url, int endPage) {
        try {
            if (this == OWNERCLAN) {
                return productPageClass
                         .getDeclaredConstructor(WebDriver.class, String.class)
                         .newInstance(driver, url);
            } else {
                return productPageClass
                         .getDeclaredConstructor(WebDriver.class, String.class, int.class)
                         .newInstance(driver, url, endPage);
            }
        } catch (Exception e) {
            throw new RuntimeException("ProductListPage 생성 실패: " + this.name(), e);
        }
    }

    public SoldOutPage createSoldOutPage() {
        try {
            return soldOutPageClass.getDeclaredConstructor().newInstance();
        } catch (Exception e) {
            throw new RuntimeException("SoldOutPage 생성 실패", e);
        }
    }
    
}