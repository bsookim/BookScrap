package com.shop.service;

import java.io.UnsupportedEncodingException;

import org.springframework.http.HttpEntity;
import org.springframework.http.HttpHeaders;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.util.UriComponentsBuilder;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.shop.CoupangUserToken;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class CoupangUserService{
	
	public void userNaverLogin(String code, String state) {
		RestTemplate restTemplate = new RestTemplate();
		String uri = "https://nid.naver.com/oauth2.0/token";

		// POST 요청에 필요한 파라미터를 바디에 담기
		MultiValueMap<String, String> parameters = new LinkedMultiValueMap<>();
		parameters.add("grant_type", "authorization_code");
		parameters.add("client_id", "cm_fk5FzhamqbdBIvOY5");
		parameters.add("client_secret", "z0XakvNT0N");
		parameters.add("redirect_uri", "http://localhost:3000/oauth/user/loginRedirection");
		parameters.add("code", code);
		parameters.add("state", state);

		// HTTP 헤더 설정 (필요시 추가)
		HttpHeaders headers = new HttpHeaders();
		headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);

		// 요청 엔티티 생성
		HttpEntity<MultiValueMap<String, String>> request = new HttpEntity<>(parameters, headers);

		// POST 요청 보내기
		ResponseEntity<CoupangUserToken> response = restTemplate.postForEntity(uri, request, CoupangUserToken.class);

		// 응답 처리
		CoupangUserToken tokenResponse = response.getBody();
		System.out.println("AcessToken::::::"+tokenResponse.getAccessToken());
		System.out.println("ExpiredIn"+tokenResponse.getExpriesIn());
	}
	
}
