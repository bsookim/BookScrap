package com.scrap.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import com.scrap.entity.Books;
import com.scrap.entity.BooksReply;
import com.scrap.repository.BooksReplyRepository;
import com.scrap.repository.BooksRepository;
import com.scrap.request.BooksReplyRequest;
import com.scrap.response.BooksReplyResponse;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
@Transactional(readOnly=true)
public class BooksReplyService {
	
	private final BooksReplyRepository booksReplyRepository;
	private final BooksRepository booksRepository;
	
	@Transactional
	public void save(BooksReplyRequest booksReplyRequest) {
		Books book= booksRepository.findById(booksReplyRequest.getBooks_id()).orElseThrow();
		BooksReply reply= BooksReply.builder()
				.content(booksReplyRequest.getContent())
				.books(book)
				.build();
		booksReplyRepository.save(reply);
	}

	@Transactional
	public void update(BooksReplyRequest booksReplyRequest) {
		BooksReply reply = booksReplyRepository.findById(booksReplyRequest.getId()).orElseThrow();
		reply.updateContent(booksReplyRequest.getContent());
		booksReplyRepository.save(reply);
	}

	public List<BooksReplyResponse> booksReplyList(Long id) {
		List<BooksReply> booksReplyList=booksReplyRepository.findAllById(id);
		
		List<BooksReplyResponse> booksReplyResponse=new ArrayList<>();
		for(BooksReply booksReply : booksReplyList) {
			booksReplyResponse.add(BooksReplyResponse.booksReplyResponse(booksReply));
		}
		
		return booksReplyResponse;
	}

	@Transactional
	public void delete(Long id) {
		booksReplyRepository.deleteById(id);
	} 
	
}
